"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateGasEstimation = validateGasEstimation;
exports.isGasEstimationValid = isGasEstimationValid;
const ethers_1 = require("ethers");
async function validateGasEstimation(provider, tx) {
    const { valid, gasEstimation } = await isGasEstimationValid(provider, tx);
    if (!valid)
        throw new Error(`Not enough gas for tx. Provided: ${tx.gasLimit}, needed: ${gasEstimation}`);
}
async function isGasEstimationValid(provider, tx) {
    const estimatedGas = await provider.estimateGas(tx);
    const gasLimit = tx.gasLimit ? (0, ethers_1.toNumber)(tx.gasLimit) : 0;
    if (!estimatedGas || estimatedGas > gasLimit) {
        throw new Error(`Not enough gas for tx. Provided: ${gasLimit}, needed: ${estimatedGas.toString()}`);
    }
    return { valid: true, gasEstimation: estimatedGas };
}
